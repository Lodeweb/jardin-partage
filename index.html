<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>JardinPartage - Plateforme Communautaire</title>

  <!-- Supabase JS v2 -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    // Instanciation du client Supabase (valeurs fournies par toi)
    const supabaseUrl = 'https://vvwaoublturvwnepluav.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ2d2FvdWJsdHVydnduZXBsdWF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxMDI5NzAsImV4cCI6MjA2ODY3ODk3MH0.X4NEPjWRze9hUToHquKVrL6ZdKQZznFjfXvNzPMIcTI';
    window.supabase = supabase.createClient(supabaseUrl, supabaseKey);
  </script>

  <!-- (Optionnel) FullCalendar & FontAwesome déjà utilisés dans ton design -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <style>
    :root { 
      --primary: #2e7d32; 
      --primary-light: #60ad5e; 
      --primary-dark: #005005; 
      --secondary: #ff9800;
      --light: #f5f5f5; 
      --dark: #333; 
      --gray: #757575; 
      --light-gray: #e0e0e0;
    }
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Verdana,sans-serif}
    body{background:#f8f9fa;color:var(--dark);line-height:1.6;min-height:100vh;position:relative}
    header{background:white;box-shadow:0 2px 10px rgba(0,0,0,.1);position:sticky;top:0;z-index:100}
    .navbar{display:flex;justify-content:space-between;align-items:center;padding:1rem 5%;max-width:1400px;margin:0 auto}
    .logo{display:flex;align-items:center;gap:10px}
    .logo i{font-size:2rem;color:var(--primary)}
    .logo h1{font-size:1.8rem;color:var(--primary);font-weight:700}
    .nav-links{display:flex;gap:2rem}
    .nav-links a{text-decoration:none;color:var(--dark);font-weight:500;transition:color .3s}
    .nav-links a:hover,.nav-links a.active{color:var(--primary)}
    .auth-buttons{display:flex;gap:1rem}
    .btn{padding:.6rem 1.2rem;border-radius:50px;font-weight:600;cursor:pointer;transition:all .2s;border:none}
    .btn-primary{background:var(--primary);color:#fff}.btn-primary:hover{background:var(--primary-dark)}
    .btn-outline{background:transparent;border:2px solid var(--primary);color:var(--primary)}
    .btn-outline:hover{background:var(--primary);color:#fff}
    .btn-secondary{background:var(--secondary);color:#fff}.btn-secondary:hover{background:#e65100}
    .hero{background:linear-gradient(rgba(0,0,0,.5),rgba(0,0,0,.5)),url('https://images.unsplash.com/photo-1523348837708-15d4a09cfac2?q=80&w=1200&auto=format&fit=crop');background-size:cover;background-position:center;color:white;text-align:center;padding:6rem 2rem;position:relative}
    .hero::before{content:'';position:absolute;inset:0;background:rgba(46,125,50,.65);z-index:1}
    .hero-content{position:relative;z-index:2;max-width:800px;margin:0 auto}
    .hero h2{font-size:2.6rem;margin-bottom:1rem;text-shadow:0 2px 4px rgba(0,0,0,.3)}
    .features,.purchase,.testimonials{padding:4rem 5%;background:white}
    .section-title{text-align:center;margin-bottom:2rem;color:var(--primary-dark)}
    .section-title h2{font-size:2rem;margin-bottom:.5rem}
    .features-grid,.tools-grid,.testimonials-grid{display:grid;gap:1.4rem}
    .features-grid{grid-template-columns:repeat(auto-fit,minmax(260px,1fr));max-width:1200px;margin:0 auto}
    .feature-card,.tool-card,.testimonial{background:white;border-radius:12px;overflow:hidden;box-shadow:0 5px 15px rgba(0,0,0,.08);transition:transform .2s}
    .feature-card:hover,.tool-card:hover{transform:translateY(-4px)}
    .feature-icon{font-size:2.4rem;color:var(--primary);margin:1rem 0}
    .catalogue{padding:4rem 5%;background:#f8f9fa}
    .tools-grid{grid-template-columns:repeat(auto-fit,minmax(280px,1fr));max-width:1200px;margin:0 auto}
    .tool-image{height:180px;display:flex;align-items:center;justify-content:center;color:var(--gray);font-size:3rem}
    .tool-info{padding:1.2rem}
    .tool-meta{display:flex;justify-content:space-between;margin:.6rem 0;color:var(--gray);gap:.5rem;flex-wrap:wrap}
    .availability{display:inline-block;padding:.25rem .6rem;border-radius:50px;font-size:.85rem;font-weight:600}
    .available{background:#e8f5e9;color:var(--primary)}
    .unavailable{background:#ffebee;color:#c62828}
    .tool-actions{display:flex;justify-content:space-between;gap:.6rem;margin-top:.8rem}
    .date-filter{display:flex;gap:.6rem;align-items:center;justify-content:center;margin:1rem auto 2rem;flex-wrap:wrap}
    .date-filter input{padding:.5rem;border:1px solid #ccc;border-radius:8px}
    footer{background:var(--primary-dark);color:#fff;padding:3rem 5% 1.5rem}
    .footer-content{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1.2rem;max-width:1200px;margin:0 auto}
    .footer-column h3{position:relative;margin-bottom:1rem}
    .footer-column h3::after{content:'';position:absolute;left:0;bottom:-8px;width:50px;height:3px;background:var(--secondary)}
    .footer-column ul{list-style:none}
    .footer-column a{color:#ddd;text-decoration:none}
    .footer-column a:hover{color:var(--secondary)}
    .social-links{display:flex;gap:.6rem;margin-top:.8rem}
    .social-links a{display:flex;align-items:center;justify-content:center;width:36px;height:36px;border-radius:50%;background:rgba(255,255,255,.1);color:white}
    @media(max-width:768px){
      .navbar{flex-direction:column;gap:1rem}
      .nav-links{flex-wrap:wrap;justify-content:center;gap:1rem}
      .hero h2{font-size:2.1rem}
    }
    .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:1000;align-items:center;justify-content:center}
    .modal-content{background:#fff;padding:1.4rem;border-radius:12px;max-width:520px;width:92%;max-height:90vh;overflow:auto}
    .close-modal{float:right;font-size:1.6rem;cursor:pointer}
    .loader{border:5px solid #f3f3f3;border-top:5px solid var(--primary);border-radius:50%;width:44px;height:44px;animation:spin 1s linear infinite;margin:20px auto;display:none}
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
    .notification{position:fixed;top:20px;right:20px;padding:12px 20px;border-radius:8px;color:white;font-weight:600;z-index:2000;opacity:0;transform:translateY(-20px);transition:opacity .25s,transform .25s;max-width:360px}
    .notification.show{opacity:1;transform:translateY(0)}
    .notification.success{background:var(--primary)}
    .notification.error{background:#d32f2f}
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="navbar">
      <div class="logo"><i class="fas fa-leaf"></i><h1>JardinPartage</h1></div>
      <nav class="nav-links">
        <a href="#" class="active">Accueil</a>
        <a href="#catalogue">Catalogue</a>
        <a href="#how-it-works">Comment ça marche</a>
        <a href="#" id="menuProposerBtn">Proposer un outil</a>
        <a href="#achats">Achats</a>
        <a href="#contact">Contact</a>
      </nav>
      <div class="auth-buttons">
        <!-- Auth non requise en mode démo ; on garde l’UI pour plus tard -->
        <button class="btn btn-outline" id="loginBtn" style="display:none">Connexion</button>
        <button class="btn btn-primary" id="registerBtn" style="display:none">Inscription</button>
        <button class="btn btn-secondary" id="logoutBtn" style="display:none">Déconnexion</button>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="hero-content">
      <h2>Partagez, empruntez, cultivez ensemble</h2>
      <p>Empruntez des outils, partagez les vôtres, ou lancez un achat collectif. **Mode démo** activé : pas de connexion requise.</p>
      <div style="display:flex;gap:1rem;justify-content:center;flex-wrap:wrap;">
        <button class="btn btn-primary" id="discoverBtn">Découvrir le catalogue</button>
        <button class="btn btn-secondary" id="proposeBtn">Proposer un outil</button>
      </div>
    </div>
  </section>

  <!-- Features -->
  <section class="features">
    <div class="section-title">
      <h2>Notre plateforme communautaire</h2>
      <p>Un jardinage plus économique et écologique, ensemble.</p>
    </div>
    <div class="features-grid">
      <div class="feature-card" style="padding:1rem;text-align:center">
        <div class="feature-icon"><i class="fas fa-tools"></i></div>
        <h3>Partage d'outils</h3>
        <p>Ajoutez vos outils et rendez service à vos voisins.</p>
      </div>
      <div class="feature-card" style="padding:1rem;text-align:center">
        <div class="feature-icon"><i class="fas fa-handshake"></i></div>
        <h3>Emprunt facile</h3>
        <p>Choisissez une période et réservez en quelques clics.</p>
      </div>
      <div class="feature-card" style="padding:1rem;text-align:center">
        <div class="feature-icon"><i class="fas fa-shopping-cart"></i></div>
        <h3>Achats collectifs</h3>
        <p>Lancez une cagnotte locale pour un outil commun.</p>
      </div>
    </div>
  </section>

  <!-- Catalogue -->
  <section class="catalogue" id="catalogue">
    <div class="section-title">
      <h2>Outils disponibles</h2>
      <p>Filtrez par période pour voir les disponibilités exactes.</p>
    </div>

    <!-- Filtres période -->
    <div class="date-filter">
      <input type="datetime-local" id="filterStart" />
      <input type="datetime-local" id="filterEnd" />
      <button id="filterBtn" class="btn btn-outline">Filtrer</button>
      <button id="clearFilterBtn" class="btn btn-outline">Réinitialiser</button>
    </div>

    <div class="tools-grid" id="catalogueGrid">
      <div class="loader" id="catalogueLoader"></div>
    </div>
  </section>

  <!-- Achats collectifs -->
  <section class="purchase" id="achats">
    <div class="section-title">
      <h2>Achats collectifs</h2>
      <p>Proposez un équipement à acheter à plusieurs (démo : insertion ouverte).</p>
    </div>
    <div style="text-align:center">
      <button class="btn btn-secondary" id="purchaseBtn">Proposer un achat collectif</button>
    </div>
  </section>

  <!-- How it works -->
  <section class="features" id="how-it-works">
    <div class="section-title"><h2>Comment ça marche ?</h2></div>
    <div class="features-grid">
      <div class="feature-card" style="padding:1rem;text-align:center">
        <div class="feature-icon"><i class="fas fa-user-plus"></i></div>
        <h3>1. Trouvez un outil</h3>
        <p>Affinez par dates pour vérifier les disponibilités.</p>
      </div>
      <div class="feature-card" style="padding:1rem;text-align:center">
        <div class="feature-icon"><i class="fas fa-search"></i></div>
        <h3>2. Réservez</h3>
        <p>Validez votre période ; les conflits sont bloqués automatiquement.</p>
      </div>
      <div class="feature-card" style="padding:1rem;text-align:center">
        <div class="feature-icon"><i class="fas fa-calendar-check"></i></div>
        <h3>3. Récupérez l’outil</h3>
        <p>Contactez le propriétaire pour le retrait.</p>
      </div>
    </div>
  </section>

  <!-- Contact -->
  <section id="contact" style="padding:4rem 5%;background:#f8f9fa">
    <div class="section-title"><h2>Contact</h2><p>Une question ? Écrivez-nous !</p></div>
    <form id="contactForm" style="max-width:420px;margin:0 auto">
      <label>Nom :</label><input type="text" id="contactName" required style="width:100%;padding:.6rem;border:1px solid #ccc;border-radius:8px;margin:.4rem 0"/>
      <label>Email :</label><input type="email" id="contactEmail" required style="width:100%;padding:.6rem;border:1px solid #ccc;border-radius:8px;margin:.4rem 0"/>
      <label>Message :</label><textarea id="contactMessage" required style="width:100%;padding:.6rem;border:1px solid #ccc;border-radius:8px;margin:.4rem 0"></textarea>
      <button type="submit" class="btn btn-primary" style="width:100%">Envoyer</button>
    </form>
  </section>

  <!-- Footer -->
  <footer>
    <div class="footer-content">
      <div class="footer-column">
        <h3>JardinPartage</h3>
        <p>Partagez, empruntez et cultivez ensemble.</p>
        <div class="social-links">
          <a href="#"><i class="fab fa-facebook-f"></i></a>
          <a href="#"><i class="fab fa-twitter"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
          <a href="#"><i class="fab fa-linkedin-in"></i></a>
        </div>
      </div>
      <div class="footer-column">
        <h3>Liens rapides</h3>
        <ul>
          <li><a href="#">Accueil</a></li>
          <li><a href="#catalogue">Catalogue</a></li>
          <li><a href="#how-it-works">Comment ça marche</a></li>
          <li><a href="#" id="footerProposerBtn">Proposer un outil</a></li>
          <li><a href="#achats">Achats collectifs</a></li>
        </ul>
      </div>
      <div class="footer-column">
        <h3>Communautés</h3>
        <ul>
          <li><a href="#">Notre village</a></li>
          <li><a href="#">Communauté de communes</a></li>
          <li><a href="#">Devenir partenaire</a></li>
          <li><a href="#">Événements</a></li>
        </ul>
      </div>
      <div class="footer-column">
        <h3>Contact</h3>
        <ul>
          <li><i class="fas fa-map-marker-alt"></i> Place de la Mairie</li>
          <li><i class="fas fa-phone"></i> 01 23 45 67 89</li>
          <li><i class="fas fa-envelope"></i> contact@jardinpartage.fr</li>
        </ul>
      </div>
    </div>
    <div style="text-align:center;margin-top:1rem;color:#ddd">© 2025 JardinPartage</div>
  </footer>

  <!-- Modales -->
  <div class="modal" id="proposerModal">
    <div class="modal-content">
      <span class="close-modal" id="closeProposerModal">&times;</span>
      <h2>Proposer un nouvel outil</h2>
      <form id="proposerForm">
        <div style="margin:.6rem 0"><label>Nom</label><input type="text" id="outilNom" required style="width:100%;padding:.6rem;border:1px solid #ccc;border-radius:8px"/></div>
        <div style="margin:.6rem 0"><label>Description</label><textarea id="outilDesc" required style="width:100%;padding:.6rem;border:1px solid #ccc;border-radius:8px"></textarea></div>
        <div style="margin:.6rem 0"><label>Localisation</label><input type="text" id="outilLocalisation" required style="width:100%;padding:.6rem;border:1px solid #ccc;border-radius:8px"/></div>
        <div style="margin:.6rem 0"><label>Propriétaire</label><input type="text" id="outilProprietaire" required style="width:100%;padding:.6rem;border:1px solid #ccc;border-radius:8px"/></div>
        <button type="submit" class="btn btn-primary" style="width:100%;margin-top:.6rem">Envoyer</button>
      </form>
    </div>
  </div>

  <div class="modal" id="reservationModal">
    <div class="modal-content">
      <span class="close-modal" id="closeReservationModal">&times;</span>
      <h2>Réserver l'outil</h2>
      <form id="reservationForm">
        <input type="hidden" id="resOutilId" />
        <div style="margin:.6rem 0"><label>Votre nom / email</label><input type="text" id="resName" required style="width:100%;padding:.6rem;border:1px solid #ccc;border-radius:8px"/></div>
        <div style="margin:.6rem 0"><label>Début</label><input type="datetime-local" id="resDateDebut" required style="width:100%;padding:.6rem;border:1px solid #ccc;border-radius:8px"/></div>
        <div style="margin:.6rem 0"><label>Fin</label><input type="datetime-local" id="resDateFin" required style="width:100%;padding:.6rem;border:1px solid #ccc;border-radius:8px"/></div>
        <button type="submit" class="btn btn-primary" style="width:100%;margin-top:.6rem">Réserver</button>
      </form>
    </div>
  </div>

  <div class="modal" id="detailsModal">
    <div class="modal-content">
      <span class="close-modal" id="closeDetailsModal">&times;</span>
      <div id="detailsContent"></div>
    </div>
  </div>

  <!-- Notifications -->
  <div id="notification" class="notification"></div>

  <!-- Scripts -->
  <script>
    // ---------- Utils ----------
    const notify = (msg, type='success') => {
      const n = document.getElementById('notification');
      n.textContent = msg;
      n.className = `notification ${type} show`;
      setTimeout(()=> n.classList.remove('show'), 3500);
    };
    const addClick = (id, fn) => {
      const el = document.getElementById(id);
      if(el) el.addEventListener('click', fn);
    };
    const toIsoOrNull = (val) => val ? new Date(val).toISOString() : null;
    const getRandomColor = () => ['#e3f2fd','#f1f8e9','#fff8e1','#ffebee','#e8f5e9','#f9fbe7'][Math.floor(Math.random()*6)];
    function getRandomToolIcon(){
      const icons = ['leaf','seedling','tree','tractor','spa','cloud-sun','sun','water','wrench','hammer','screwdriver','broom'];
      return icons[Math.floor(Math.random()*icons.length)];
    }

    // ---------- Catalogue ----------
    async function chargerCatalogue() {
      const loader = document.getElementById('catalogueLoader');
      const grid   = document.getElementById('catalogueGrid');
      grid.innerHTML = '';
      loader.style.display = 'block';

      const startISO = toIsoOrNull(document.getElementById('filterStart').value);
      const endISO   = toIsoOrNull(document.getElementById('filterEnd').value);

      try {
        let outils = [];
        let dispoMap = null;

        if(startISO && endISO){
          // 1) dispo sur période
          const { data: dispoRows, error: dispoErr } = await supabase.rpc('outils_disponibles', { p_debut: startISO, p_fin: endISO });
          if(dispoErr) throw dispoErr;

          dispoMap = new Map(dispoRows.map(r => [r.id, r.disponible]));

          const ids = dispoRows.map(r => r.id);
          if(ids.length){
            const { data: outilsRows, error } = await supabase
              .from('outils').select('*').in('id', ids).order('created_at', { ascending: false });
            if(error) throw error;
            outils = outilsRows;
          }
        } else {
          // 2) affichage simple (disponible "maintenant")
          const { data: outilsRows, error } = await supabase
            .from('outils').select('*').order('created_at', { ascending: false });
          if(error) throw error;
          outils = outilsRows;
        }

        if(!outils || !outils.length){
          grid.innerHTML = '<p style="text-align:center;width:100%">Aucun outil pour le moment.</p>';
          return;
        }

        for(const o of outils){
          const dispo = (dispoMap!==null) ? dispoMap.get(o.id) : !!o.disponible;
          const card = document.createElement('div');
          card.className = 'tool-card';
          card.innerHTML = `
            <div class="tool-image" style="background:${getRandomColor()}">
              <i class="fas fa-${getRandomToolIcon()}"></i>
            </div>
            <div class="tool-info">
              <h3>${o.nom}</h3>
              <p>${o.description ?? ''}</p>
              <div class="tool-meta">
                <span><i class="fas fa-user"></i> ${o.proprietaire ?? '—'}</span>
                <span><i class="fas fa-map-marker-alt"></i> ${o.localisation ?? '—'}</span>
              </div>
              <div class="availability ${dispo ? 'available' : 'unavailable'}">
                ${dispo ? ( (dispoMap!==null) ? 'Disponible sur la période' : 'Disponible' )
                         : ( (dispoMap!==null) ? 'Réservé sur la période' : 'Indisponible maintenant' )}
              </div>
              <div class="tool-actions">
                <button class="btn btn-outline" data-action="details" data-id="${o.id}">Détails</button>
                <button class="btn btn-primary"  data-action="reserve" data-id="${o.id}" ${dispo ? '' : 'disabled'}>Réserver</button>
              </div>
            </div>`;
          grid.appendChild(card);
        }
      } catch(err){
        console.error(err);
        notify('Erreur lors du chargement du catalogue', 'error');
      } finally {
        loader.style.display = 'none';
      }
    }

    // ---------- Détails ----------
    async function afficherDetails(id){
      const { data: o, error } = await supabase.from('outils').select('*').eq('id', id).single();
      if(error){ notify('Erreur de chargement des détails', 'error'); return; }

      const start = document.getElementById('filterStart').value || '';
      const end   = document.getElementById('filterEnd').value || '';

      const html = `
        <h3>${o.nom}</h3>
        <p><strong>Description:</strong> ${o.description ?? ''}</p>
        <p><strong>Propriétaire:</strong> ${o.proprietaire ?? '—'}</p>
        <p><strong>Localisation:</strong> ${o.localisation ?? '—'}</p>
        <div style="margin-top:1rem;display:flex;gap:.6rem;flex-wrap:wrap">
          <button class="btn btn-primary" id="detailsReserveBtn">Réserver</button>
          <button class="btn btn-outline" id="detailsCloseBtn">Fermer</button>
        </div>`;
      document.getElementById('detailsContent').innerHTML = html;
      const detailsModal = document.getElementById('detailsModal');
      detailsModal.style.display = 'flex';

      // actions
      document.getElementById('detailsCloseBtn').onclick = ()=> detailsModal.style.display='none';
      document.getElementById('detailsReserveBtn').onclick = ()=>{
        // open reservation modal with pre-filled dates (from filter)
        document.getElementById('resOutilId').value = o.id;
        if(start) document.getElementById('resDateDebut').value = start;
        if(end)   document.getElementById('resDateFin').value   = end;
        detailsModal.style.display='none';
        document.getElementById('reservationModal').style.display='flex';
      };
    }

    // ---------- Réservation ----------
    async function reserverOutil(e){
      e.preventDefault();
      const outilId   = document.getElementById('resOutilId').value;
      const name      = document.getElementById('resName').value.trim();
      const debutISO  = toIsoOrNull(document.getElementById('resDateDebut').value);
      const finISO    = toIsoOrNull(document.getElementById('resDateFin').value);

      if(!debutISO || !finISO){ notify('Veuillez renseigner une période complète', 'error'); return; }

      try {
        const { error } = await supabase.from('reservations').insert([{
          outil_id: outilId,
          emprunteur: name || 'anonyme',
          date_debut: debutISO,
          date_fin: finISO
        }]);

        if(error){
          // Contrainte d’exclusion si chevauchement
          notify(error.message.includes('exclude') || error.code === '23P01'
                  ? 'Conflit : la période chevauche une autre réservation.'
                  : ('Erreur réservation : ' + error.message), 'error');
          return;
        }

        notify('Réservation enregistrée !', 'success');
        document.getElementById('reservationModal').style.display='none';
        // refresh catalogue
        chargerCatalogue();
      } catch(err){
        console.error(err);
        notify('Erreur technique lors de la réservation', 'error');
      }
    }

    // ---------- Proposer un outil ----------
    async function proposerOutil(e){
      e.preventDefault();
      const nom = document.getElementById('outilNom').value.trim();
      const description = document.getElementById('outilDesc').value.trim();
      const localisation = document.getElementById('outilLocalisation').value.trim();
      const proprietaire = document.getElementById('outilProprietaire').value.trim();
      if(!nom){ notify('Nom obligatoire', 'error'); return; }

      const { error } = await supabase.from('outils').insert([{ nom, description, localisation, proprietaire, disponible:true }]);
      if(error){ notify('Erreur : '+error.message, 'error'); return; }

      notify('Merci ! Outil ajouté.', 'success');
      document.getElementById('proposerModal').style.display='none';
      document.getElementById('proposerForm').reset();
      chargerCatalogue();
    }

    // ---------- DOM Ready ----------
    document.addEventListener('DOMContentLoaded', ()=>{
      // Navigation smooth
      document.querySelectorAll('.nav-links a, .footer-column a').forEach(a=>{
        a.addEventListener('click', e=>{
          if(a.hash && document.querySelector(a.hash)){
            e.preventDefault();
            document.querySelector(a.hash).scrollIntoView({behavior:'smooth'});
          }
        });
      });

      // Hero buttons
      addClick('discoverBtn', ()=> document.getElementById('catalogue').scrollIntoView({behavior:'smooth'}));

      // Proposer un outil (3 entrées)
      const proposerModal = document.getElementById('proposerModal');
      addClick('proposeBtn',        ()=> proposerModal.style.display='flex');
      addClick('menuProposerBtn',   ()=> proposerModal.style.display='flex');
      addClick('footerProposerBtn', ()=> proposerModal.style.display='flex');
      addClick('closeProposerModal',()=> proposerModal.style.display='none');
      document.getElementById('proposerForm').addEventListener('submit', proposerOutil);
      window.addEventListener('click', e=>{ if(e.target===proposerModal) proposerModal.style.display='none'; });

      // Réservation
      const reservationModal = document.getElementById('reservationModal');
      addClick('closeReservationModal', ()=> reservationModal.style.display='none');
      document.getElementById('reservationForm').addEventListener('submit', reserverOutil);
      window.addEventListener('click', e=>{ if(e.target===reservationModal) reservationModal.style.display='none'; });

      // Détails
      const detailsModal = document.getElementById('detailsModal');
      addClick('closeDetailsModal', ()=> detailsModal.style.display='none');
      window.addEventListener('click', e=>{ if(e.target===detailsModal) detailsModal.style.display='none'; });

      // Catalogue: delegation
      document.getElementById('catalogueGrid').addEventListener('click', (e)=>{
        const btn = e.target.closest('button');
        if(!btn) return;
        const id = btn.dataset.id;
        const action = btn.dataset.action;
        if(action==='details') afficherDetails(id);
        if(action==='reserve'){
          document.getElementById('resOutilId').value = id;
          // pré-remplir avec le filtre s’il existe
          const s = document.getElementById('filterStart').value;
          const f = document.getElementById('filterEnd').value;
          if(s) document.getElementById('resDateDebut').value = s;
          if(f) document.getElementById('resDateFin').value = f;
          reservationModal.style.display='flex';
        }
      });

      // Filtres période
      addClick('filterBtn', chargerCatalogue);
      addClick('clearFilterBtn', ()=>{
        document.getElementById('filterStart').value = '';
        document.getElementById('filterEnd').value   = '';
        chargerCatalogue();
      });

      // Achats (placeholder démo)
      addClick('purchaseBtn', ()=> notify('Module Achats collectifs : à venir (table déjà prête)', 'success'));

      // Charger catalogue au démarrage
      chargerCatalogue();
    });
  </script>
</body>
</html>
