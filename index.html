<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>JardinPartage - Plateforme Communautaire</title>

  <!-- ① On charge Supabase JS v2 (SEULE inclusion) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // ② On crée le client Supabase AVANT tout autre code
    const supabaseUrl = 'https://vvwaoublturvwnepluav.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ2d2FvdWJsdHVydnduZXBsdWF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxMDI5NzAsImV4cCI6MjA2ODY3ODk3MH0.X4NEPjWRze9hUToHquKVrL6ZdKQZznFjfXvNzPMIcTI';
    window.supabase = supabase.createClient(supabaseUrl, supabaseKey);
    console.log('✅ Supabase prêt', window.supabase);
  </script>

  <!-- FullCalendar & FontAwesome -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <style>
    /* … ici tout votre CSS existant … */
    /* (j’ai omis la feuille de style pour alléger la réponse) */
  </style>
</head>
<body>
  <!-- … ici tout votre HTML existant … -->
  <div class="status-bar" id="statusBar"></div>
  <header>…</header>
  <section class="hero">…</section>
  <section class="catalogue" id="catalogue">
    <div class="section-title">…</div>
    <div class="tools-grid" id="catalogueGrid">
      <div class="loader" id="catalogueLoader"></div>
    </div>
  </section>
  <!-- etc. jusqu’à la fin du body -->

  <!-- Modales, notification container, footer… -->

  <!-- FullCalendar & localisation FR -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales/fr.min.js"></script>

  <!-- ③ Votre code métier : DOMContentLoaded, chargerCatalogue(), modales, réservations, etc. -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Animation barre d’état
      const statusBar = document.getElementById('statusBar');
      statusBar.classList.add('active');
      setTimeout(() => statusBar.classList.remove('active'), 1000);

      // Notification helper
      function showNotification(msg, type) {
        const n = document.getElementById('notification');
        n.textContent = msg;
        n.className = `notification ${type} show`;
        setTimeout(() => n.classList.remove('show'), 3000);
      }

      // Charger catalogue
      async function chargerCatalogue() {
        const loader = document.getElementById('catalogueLoader');
        loader.style.display = 'block';
        const { data: outils, error } = await supabase
          .from('outils')
          .select('*')
          .order('created_at', { ascending: false });
        const grid = document.getElementById('catalogueGrid');
        grid.innerHTML = '';
        if (error) {
          showNotification('Erreur de chargement', 'error');
        } else if (!outils || outils.length === 0) {
          grid.innerHTML = '<p>Aucun outil disponible.</p>';
        } else {
          outils.forEach(outil => {
            const card = document.createElement('div');
            card.className = 'tool-card';
            card.innerHTML = `
              <div class="tool-image"><i class="fas fa-leaf"></i></div>
              <div class="tool-info">
                <h3>${outil.nom}</h3>
                <p>${outil.description}</p>
                <div class="tool-meta">
                  <span><i class="fas fa-user"></i> ${outil.proprietaire}</span>
                  <span><i class="fas fa-map-marker-alt"></i> ${outil.localisation}</span>
                </div>
                <div class="availability ${outil.disponible ? 'available' : 'unavailable'}">
                  ${outil.disponible ? 'Disponible' : 'Indisponible'}
                </div>
                <div class="tool-actions">
                  <button class="btn btn-outline details-btn" data-id="${outil.id}">Détails</button>
                  <button class="btn btn-primary reserve-btn" data-id="${outil.id}" ${outil.disponible ? '' : 'disabled'}>Réserver</button>
                </div>
              </div>`;
            grid.appendChild(card);
          });
        }
        loader.style.display = 'none';
      }

      // Initial load
      chargerCatalogue();

      // … reste de votre code : modales, connexion, réservation, etc. …
    });
  </script>
</body>
</html>
