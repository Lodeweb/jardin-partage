<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>JardinPartage – Plateforme Communautaire</title>

  <!-- FullCalendar & FontAwesome -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

  <style>
    :root {
      --primary: #2e7d32;
      --primary-light: #60ad5e;
      --primary-dark: #005005;
      --secondary: #ff9800;
      --light: #f5f5f5;
      --dark: #333;
      --gray: #757575;
      --light-gray: #e0e0e0;
    }
    * { margin:0; padding:0; box-sizing:border-box; font-family:Segoe UI, Tahoma, Verdana, sans-serif; }
    body { background:#f8f9fa; color:var(--dark); line-height:1.6; min-height:100vh; }
    header { background:#fff; box-shadow:0 2px 10px rgba(0,0,0,.1); position:sticky; top:0; z-index:100; }
    .navbar{display:flex;justify-content:space-between;align-items:center;padding:1rem 5%;max-width:1400px;margin:0 auto;}
    .logo i{font-size:2rem;color:var(--primary);}
    .logo h1{font-size:1.8rem;color:var(--primary);font-weight:700;}
    .nav-links{display:flex;gap:2rem;}
    .nav-links a{color:var(--dark);text-decoration:none;font-weight:500;transition:color .3s;}
    .nav-links a:hover,
    .nav-links a.active{color:var(--primary);}
    .auth-buttons{display:flex;gap:1rem;}
    .btn{padding:.6rem 1.5rem;border-radius:50px;font-weight:600;cursor:pointer;transition:all .3s;border:none;}
    .btn-primary{background:var(--primary);color:#fff;}
    .btn-primary:hover{background:var(--primary-dark);}
    .btn-outline{background:transparent;border:2px solid var(--primary);color:var(--primary);}
    .btn-outline:hover{background:var(--primary);color:#fff;}
    .btn-secondary{background:var(--secondary);color:#fff;}
    .btn-secondary:hover{background:#e65100;}
    .hero{position:relative;color:#fff;text-align:center;padding:6rem 2rem;
      background:url('https://images.unsplash.com/photo-1523348837708-15d4a09cfac2?q=80&w=1000&auto=format&fit=crop')center/cover no-repeat;
    }
    .hero::before{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(46,125,50,.7);}
    .hero-content{position:relative;z-index:2;max-width:800px;margin:0 auto;}
    .hero h2{font-size:3rem;margin-bottom:1.5rem;text-shadow:0 2px 4px rgba(0,0,0,.3);}
    .hero p{font-size:1.2rem;margin-bottom:2rem;max-width:600px;margin:auto;}
    .section-title{text-align:center;margin-bottom:3rem;color:var(--primary-dark);}
    .section-title h2{font-size:2.5rem;margin-bottom:1rem;}
    .section-title p{color:var(--gray);max-width:700px;margin:auto;}
    .features,.purchase,.catalogue,.how-it-works,.testimonials{padding:5rem 5%;}
    .features-grid,.tools-grid,.testimonials-grid{display:grid;gap:2rem;max-width:1200px;margin:0 auto;}
    .features-grid{grid-template-columns:repeat(auto-fit,minmax(300px,1fr));}
    .tools-grid{grid-template-columns:repeat(auto-fill,minmax(280px,1fr));}
    .testimonials-grid{grid-template-columns:repeat(auto-fit,minmax(300px,1fr));}
    .feature-card,.tool-card,.testimonial{background:#fff;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,.1);padding:2rem;text-align:center;transition:transform .3s;}
    .feature-card:hover,.tool-card:hover{transform:translateY(-10px);}
    .feature-icon,.step-icon{font-size:3rem;color:var(--primary);margin-bottom:1.5rem;}
    .tool-image{height:200px;background:var(--light-gray) center/cover no-repeat;color:var(--gray);font-size:4rem;display:flex;align-items:center;justify-content:center;}
    .tool-info{padding:1.5rem;}
    .tool-meta{display:flex;justify-content:space-between;color:var(--gray);margin:1rem 0;}
    .availability{display:inline-block;padding:.3rem .8rem;border-radius:50px;font-size:.9rem;font-weight:500;}
    .available{background:#e8f5e9;color:var(--primary);}
    .unavailable{background:#ffebee;color:#c62828;}
    .how-it-works .features-grid{grid-template-columns:repeat(auto-fit,minmax(250px,1fr));}
    .step{position:relative;padding:2rem;background:#fff;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,.05);}
    .step::before{counter-increment:step-counter;content:counter(step-counter);position:absolute;top:-20px;left:50%;transform:translateX(-50%);width:40px;height:40px;background:var(--primary);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;}
    .purchase-content{text-align:center;}
    .testimonials .testimonial{background:#f8f9fa;padding:2rem;position:relative;}
    .testimonial::before{content:"“";position:absolute;top:20px;left:20px;font-size:4rem;color:var(--light-gray);font-family:serif;}
    footer{background:var(--primary-dark);color:#ddd;padding:4rem 5% 2rem;}
    .footer-content{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:2rem;max-width:1200px;margin:0 auto;}
    .footer-column h3{position:relative;margin-bottom:1.5rem;}
    .footer-column h3::after{content:'';position:absolute;bottom:-10px;left:0;width:50px;height:3px;background:var(--secondary);}
    .footer-column ul{list-style:none;}
    .footer-column a{color:#ddd;text-decoration:none;transition:color .3s;}
    .footer-column a:hover{color:var(--secondary);}
    .social-links{display:flex;gap:1rem;margin-top:1rem;}
    .social-links a{width:40px;height:40px;border-radius:50%;background:rgba(255,255,255,.1);display:flex;align-items:center;justify-content:center;color:#fff;transition:background .3s;}
    .social-links a:hover{background:var(--secondary);}
    .contact form input,.contact form textarea{width:100%;margin-bottom:1rem;padding:.5rem;border:1px solid #ccc;border-radius:5px;}
    .modal{display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,.7);z-index:1000;align-items:center;justify-content:center;}
    .modal-content{background:#fff;padding:2rem;border-radius:10px;max-width:600px;width:90%;max-height:90vh;overflow-y:auto;position:relative;}
    .close-modal{position:absolute;top:10px;right:15px;font-size:1.5rem;cursor:pointer;}
    .status-bar{position:fixed;top:0;left:0;width:100%;height:4px;background:var(--primary);transform:translateX(-100%);transition:transform .3s;z-index:2000;}
    .status-bar.active{transform:translateX(0);}
    .notification{position:fixed;top:20px;right:20px;padding:15px 25px;border-radius:5px;color:#fff;font-weight:600;opacity:0;transform:translateY(-20px);transition:opacity .3s,transform .3s;z-index:2001;}
    .notification.show{opacity:1;transform:translateY(0);}
    .notification.success{background:var(--primary);}
    .notification.error{background:#d32f2f;}
    #calendar{max-width:900px;margin:20px auto;}
    .fc .fc-event{border:none;}
  </style>
</head>
<body>
  <!-- Barre de statut & notifications -->
  <div class="status-bar" id="statusBar"></div>
  <div id="notification" class="notification"></div>

  <!-- Header -->
  <header>
    <div class="navbar">
      <div class="logo">
        <i class="fas fa-leaf"></i>
        <h1>JardinPartage</h1>
      </div>
      <nav class="nav-links">
        <a href="#" class="active">Accueil</a>
        <a href="#catalogue">Catalogue</a>
        <a href="#how-it-works">Comment ça marche</a>
        <a href="#" id="menuProposerBtn">Proposer un outil</a>
        <a href="#achats">Achats</a>
        <a href="#contact">Contact</a>
      </nav>
      <div class="auth-buttons">
        <button class="btn btn-outline" id="loginBtn">Connexion</button>
        <button class="btn btn-primary" id="registerBtn">Inscription</button>
        <button class="btn btn-secondary" id="logoutBtn" style="display:none;">Déconnexion</button>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="hero-content">
      <h2>Partagez, empruntez, cultivez ensemble</h2>
      <p>Une communauté d'entraide pour l'entretien de vos jardins. Empruntez des outils, partagez vos appareils, ou proposez un achat collectif.</p>
      <div style="display:flex;gap:1rem;justify-content:center;flex-wrap:wrap;">
        <button class="btn btn-primary" id="discoverBtn">Découvrir le catalogue</button>
        <button class="btn btn-secondary" id="proposeBtn">Proposer un outil</button>
      </div>
    </div>
  </section>

  <!-- Features -->
  <section class="features">
    <div class="section-title">
      <h2>Notre plateforme communautaire</h2>
      <p>JardinPartage facilite le partage d'outils et d'appareils entre voisins pour un jardinage plus économique et écologique.</p>
    </div>
    <div class="features-grid">
      <div class="feature-card">
        <i class="fas fa-tools feature-icon"></i>
        <h3>Partage d'outils</h3>
        <p>Mettez à disposition vos outils peu utilisés et empruntez ceux dont vous avez besoin.</p>
      </div>
      <div class="feature-card">
        <i class="fas fa-handshake feature-icon"></i>
        <h3>Emprunt facile</h3>
        <p>Réservez en ligne, rencontrez votre voisin et profitez des outils nécessaires.</p>
      </div>
      <div class="feature-card">
        <i class="fas fa-shopping-cart feature-icon"></i>
        <h3>Achats collectifs</h3>
        <p>Proposez l'achat d'un équipement et mutualisez les coûts avec la communauté.</p>
      </div>
    </div>
  </section>

  <!-- Catalogue -->
  <section class="catalogue" id="catalogue">
    <div class="section-title">
      <h2>Outils disponibles</h2>
      <p>Découvrez les outils que vous pouvez emprunter dans votre communauté</p>
    </div>
    <div class="tools-grid" id="catalogueGrid">
      <div class="loader" id="catalogueLoader"></div>
    </div>
  </section>

  <!-- Achats collectifs -->
  <section class="purchase" id="achats">
    <div class="section-title">
      <h2>Achats collectifs</h2>
      <p>Proposez un équipement manquant : si suffisamment de membres sont intéressés, nous l'achèterons ensemble.</p>
    </div>
    <div class="purchase-content">
      <button class="btn btn-secondary" id="purchaseBtn">Proposer un achat collectif</button>
    </div>
  </section>

  <!-- How it works -->
  <section class="how-it-works" id="how-it-works">
    <div class="section-title">
      <h2>Comment ça marche ?</h2>
      <p>En quelques étapes simples, empruntez ou partagez vos outils de jardinage.</p>
    </div>
    <div class="features-grid">
      <div class="feature-card">
        <i class="fas fa-user-plus feature-icon"></i>
        <h3>Inscription</h3>
        <p>Créez votre compte et rejoignez votre communauté locale.</p>
      </div>
      <div class="feature-card">
        <i class="fas fa-search feature-icon"></i>
        <h3>Recherche</h3>
        <p>Parcourez le catalogue ou proposez vos propres outils.</p>
      </div>
      <div class="feature-card">
        <i class="fas fa-calendar-check feature-icon"></i>
        <h3>Réservation</h3>
        <p>Réservez l'outil et convenez d'un rendez-vous avec le propriétaire.</p>
      </div>
    </div>
  </section>

  <!-- Testimonials -->
  <section class="testimonials">
    <div class="section-title">
      <h2>Témoignages</h2>
      <p>Ce que disent les membres de notre communauté</p>
    </div>
    <div class="testimonials-grid">
      <div class="testimonial">
        <p>"Grâce à JardinPartage, j'ai pu emprunter une tondeuse sans acheter la mienne."</p>
        <div class="testimonial-author">
          <i class="fas fa-user author-avatar"></i>
          <div>
            <h4>Sophie Martin</h4>
            <small>Membre depuis 2022</small>
          </div>
        </div>
      </div>
      <div class="testimonial">
        <p>"Le broyeur de végétaux acheté collectivement a été un vrai succès !"</p>
        <div class="testimonial-author">
          <i class="fas fa-user author-avatar"></i>
          <div>
            <h4>Pierre Dubois</h4>
            <small>Membre depuis 2021</small>
          </div>
        </div>
      </div>
      <div class="testimonial">
        <p>"Plateforme sécurisée, échanges et emprunts sans encombre."</p>
        <div class="testimonial-author">
          <i class="fas fa-user author-avatar"></i>
          <div>
            <h4>Émilie Rousseau</h4>
            <small>Membre depuis 2023</small>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Contact -->
  <section class="contact" id="contact">
    <div class="section-title">
      <h2>Contact</h2>
      <p>Une question, une suggestion ? Écrivez-nous !</p>
    </div>
    <form id="contactForm" style="max-width:400px;margin:0 auto;">
      <input type="text" id="contactName" placeholder="Nom" required>
      <input type="email" id="contactEmail" placeholder="Email" required>
      <textarea id="contactMessage" placeholder="Message" required></textarea>
      <button type="submit" class="btn btn-primary">Envoyer</button>
    </form>
  </section>

  <!-- Footer -->
  <footer>
    <div class="footer-content">
      <div class="footer-column">
        <h3>JardinPartage</h3>
        <p>Partagez, empruntez et cultivez ensemble.</p>
        <div class="social-links">
          <a href="#"><i class="fab fa-facebook-f"></i></a>
          <a href="#"><i class="fab fa-twitter"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
          <a href="#"><i class="fab fa-linkedin-in"></i></a>
        </div>
      </div>
      <div class="footer-column">
        <h3>Liens rapides</h3>
        <ul>
          <li><a href="#">Accueil</a></li>
          <li><a href="#catalogue">Catalogue</a></li>
          <li><a href="#how-it-works">Comment ça marche</a></li>
          <li><a href="#" id="footerProposerBtn">Proposer un outil</a></li>
          <li><a href="#achats">Achats collectifs</a></li>
        </ul>
      </div>
      <div class="footer-column">
        <h3>Communautés</h3>
        <ul>
          <li><a href="#">Notre village</a></li>
          <li><a href="#">Communauté de communes</a></li>
          <li><a href="#">Devenir partenaire</a></li>
          <li><a href="#">Événements</a></li>
        </ul>
      </div>
      <div class="footer-column">
        <h3>Contact</h3>
        <ul>
          <li><i class="fas fa-map-marker-alt"></i> Place de la Mairie</li>
          <li><i class="fas fa-phone"></i> 01 23 45 67 89</li>
          <li><i class="fas fa-envelope"></i> contact@jardinpartage.fr</li>
        </ul>
      </div>
    </div>
    <p style="text-align:center;color:#aaa;padding:2rem 0">&copy; 2023 JardinPartage. Tous droits réservés.</p>
  </footer>

  <!-- Modales -->
  <!-- Connexion -->
  <div class="modal" id="loginModal">
    <div class="modal-content">
      <span class="close-modal" id="closeLoginModal">&times;</span>
      <h2>Connexion</h2>
      <form id="loginForm">
        <input type="email" id="email" placeholder="Email" required>
        <input type="password" id="password" placeholder="Mot de passe" required>
        <button class="btn btn-primary">Se connecter</button>
      </form>
    </div>
  </div>
  <!-- Inscription -->
  <div class="modal" id="registerModal">
    <div class="modal-content">
      <span class="close-modal" id="closeRegisterModal">&times;</span>
      <h2>Inscription</h2>
      <form id="registerForm">
        <input type="email" id="regEmail" placeholder="Email" required>
        <input type="password" id="regPassword" placeholder="Mot de passe" required>
        <button class="btn btn-primary">S'inscrire</button>
      </form>
    </div>
  </div>
  <!-- Proposer un outil -->
  <div class="modal" id="proposerModal">
    <div class="modal-content">
      <span class="close-modal" id="closeProposerModal">&times;</span>
      <h2>Proposer un outil</h2>
      <form id="proposerForm">
        <input type="text" id="outilNom" placeholder="Nom de l'outil" required>
        <textarea id="outilDesc" placeholder="Description" required></textarea>
        <input type="text" id="outilLocalisation" placeholder="Localisation" required>
        <input type="text" id="outilProprietaire" placeholder="Propriétaire" required>
        <button class="btn btn-primary">Envoyer</button>
      </form>
    </div>
  </div>
  <!-- Réservation -->
  <div class="modal" id="reservationModal">
    <div class="modal-content">
      <span class="close-modal" id="closeReservationModal">&times;</span>
      <h2>Réserver l'outil</h2>
      <form id="reservationForm">
        <input type="text" id="resName" placeholder="Votre nom ou email" required>
        <input type="datetime-local" id="resDateDebut" required>
        <input type="datetime-local" id="resDateFin" required>
        <input type="hidden" id="resOutilId">
        <button class="btn btn-primary">Réserver</button>
      </form>
    </div>
  </div>
  <!-- Détails + calendrier -->
  <div class="modal" id="detailsModal">
    <div class="modal-content">
      <span class="close-modal" id="closeDetailsModal">&times;</span>
      <div id="detailsContent"></div>
      <div id="calendar"></div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales/fr.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    // Supabase
    const supabaseUrl  = 'https://vvwaoublturvwnepluav.supabase.co';
    const supabaseKey  = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ2d2FvdWJsdHVydnduZXBsdWF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxMDI5NzAsImV4cCI6MjA2ODY3ODk3MH0.X4NEPjWRze9hUToHquKVrL6ZdKQZznFjfXvNzPMIcTI;  // ← remplace par ta clé anon
    const supabase     = supabase.createClient(supabaseUrl, supabaseKey);

    // Notifs & barre de statut
    function showNotification(msg,type){
      const n = document.getElementById('notification');
      n.textContent = msg;
      n.className = `notification ${type} show`;
      setTimeout(()=>n.classList.remove('show'),3000);
    }
    function animateStatusBar(){
      const sb = document.getElementById('statusBar');
      sb.classList.add('active');
      setTimeout(()=>sb.classList.remove('active'),1000);
    }

    // FullCalendar
    let calendar = null;
    async function loadCalendarForTool(toolId){
      const { data: resas } = await supabase
        .from('reservations')
        .select('date_debut,date_fin,statut')
        .eq('outil_id',toolId);
      const events = resas.map(r=>({
        title: r.statut==='en_attente'?'En attente':'Réservé',
        start: r.date_debut,
        end:   r.date_fin,
        color: r.statut==='en_attente'?'#FFA500':'#E53935'
      }));
      const calEl = document.getElementById('calendar');
      if(!calendar){
        calendar = new FullCalendar.Calendar(calEl,{
          initialView:'timeGridWeek',
          locale:'fr',
          headerToolbar:{
            left:'prev,next today',
            center:'title',
            right:'timeGridDay,timeGridWeek,dayGridMonth'
          },
          events
        });
        calendar.render();
      } else {
        calendar.removeAllEvents();
        calendar.addEventSource(events);
      }
    }

    // Afficher détails + calendrier
    async function afficherDetails(id){
      const { data: outil, error } = await supabase
        .from('outils').select('*').eq('id',id).single();
      if(error||!outil){
        showNotification("Erreur chargement détail",'error');
        return;
      }
      document.getElementById('detailsContent').innerHTML=`
        <h2>${outil.nom}</h2>
        <p><strong>Description :</strong> ${outil.description}</p>
        <p><strong>Propriétaire :</strong> ${outil.proprietaire}</p>
        <p><strong>Localisation :</strong> ${outil.localisation}</p>
        <p><strong>Disponibilité :</strong> ${outil.disponible?'Disponible':'Indisponible'}</p>
        <button class="btn btn-primary" onclick="
          document.getElementById('resOutilId').value=${outil.id};
          document.getElementById('reservationModal').style.display='flex';
          document.getElementById('detailsModal').style.display='none';
        ">Réserver</button>
      `;
      document.getElementById('detailsModal').style.display='flex';
      loadCalendarForTool(id);
    }

    // Générateurs d’icônes/couleurs aléatoires
    function getRandomColor(){
      const colors=['#e3f2fd','#f1f8e9','#fff8e1','#ffebee','#e8f5e9','#f9fbe7'];
      return colors[Math.floor(Math.random()*colors.length)];
    }
    function getRandomToolIcon(){
      const icons=['leaf','seedling','tree','tractor','spa','cloud-sun','sun','water'];
      return icons[Math.floor(Math.random()*icons.length)];
    }

    // Chargement du catalogue
    async function chargerCatalogue(){
      document.getElementById('catalogueLoader').style.display='block';
      const { data: outils, error } = await supabase
        .from('outils').select('*').order('created_at',{ascending:false});
      const grid=document.getElementById('catalogueGrid');
      grid.innerHTML='';
      if(error){
        showNotification("Erreur catalogue",'error');
        grid.innerHTML='<p>Erreur de chargement.</p>'; 
      } else if(!outils.length){
        grid.innerHTML='<p>Aucun outil pour l’instant.</p>';
      } else {
        outils.forEach(o=>{
          const card=document.createElement('div');
          card.className='tool-card';
          card.innerHTML=`
            <div class="tool-image" style="background:${getRandomColor()}">
              <i class="fas fa-${getRandomToolIcon()}"></i>
            </div>
            <div class="tool-info">
              <h3>${o.nom}</h3>
              <p>${o.description}</p>
              <div class="tool-meta">
                <span><i class="fas fa-user"></i> ${o.proprietaire||'Utilisateur'}</span>
                <span><i class="fas fa-map-marker-alt"></i> ${o.localisation||''}</span>
              </div>
              <div class="availability ${o.disponible?'available':'unavailable'}">
                ${o.disponible?'Disponible':'Indisponible'}
              </div>
              <div class="tool-actions">
                <button class="btn btn-outline details-btn" data-id="${o.id}">Détails</button>
                <button class="btn btn-primary reserve-btn" data-id="${o.id}" ${o.disponible?'':'disabled'}>Réserver</button>
              </div>
            </div>
          `;
          grid.appendChild(card);
        });
      }
      document.getElementById('catalogueLoader').style.display='none';
    }

    document.addEventListener('DOMContentLoaded',()=>{
      animateStatusBar();
      chargerCatalogue();

      // Scroll smooth
      document.querySelectorAll('.nav-links a, .footer-column a').forEach(a=>{
        a.addEventListener('click',e=>{
          if(a.hash && document.querySelector(a.hash)){
            e.preventDefault();
            document.querySelector(a.hash).scrollIntoView({behavior:'smooth'});
          }
        });
      });

      // Auth, Proposer, Réserver, Détails…
      const loginBtn=document.getElementById('loginBtn'),
            registerBtn=document.getElementById('registerBtn'),
            logoutBtn=document.getElementById('logoutBtn'),
            loginModal=document.getElementById('loginModal'),
            registerModal=document.getElementById('registerModal'),
            closeLoginModal=document.getElementById('closeLoginModal'),
            closeRegisterModal=document.getElementById('closeRegisterModal'),
            loginForm=document.getElementById('loginForm'),
            registerForm=document.getElementById('registerForm');

      loginBtn.onclick=()=>loginModal.style.display='flex';
      registerBtn.onclick=()=>registerModal.style.display='flex';
      closeLoginModal.onclick=()=>loginModal.style.display='none';
      closeRegisterModal.onclick=()=>registerModal.style.display='none';
      window.onclick=e=>{
        if(e.target===loginModal)loginModal.style.display='none';
        if(e.target===registerModal)registerModal.style.display='none';
      };

      registerForm.onsubmit=async e=>{
        e.preventDefault();
        const email=document.getElementById('regEmail').value,
              pwd=document.getElementById('regPassword').value;
        const { error }=await supabase.auth.signUp({ email:email,password:pwd });
        if(error) showNotification('Inscription : '+error.message,'error');
        else { showNotification('Inscription réussie','success');registerModal.style.display='none'; }
      };

      loginForm.onsubmit=async e=>{
        e.preventDefault();
        const email=document.getElementById('email').value,
              pwd=document.getElementById('password').value;
        const { error }=await supabase.auth.signInWithPassword({ email, password:pwd });
        if(error) showNotification('Connexion : '+error.message,'error');
        else {
          showNotification('Connexion réussie','success');
          loginModal.style.display='none';
          loginBtn.style.display='none';
          registerBtn.style.display='none';
          logoutBtn.style.display='inline-block';
        }
      };

      logoutBtn.onclick=async ()=>{
        await supabase.auth.signOut();
        showNotification('Déconnecté','success');
        loginBtn.style.display='inline-block';
        registerBtn.style.display='inline-block';
        logoutBtn.style.display='none';
      };

      supabase.auth.getSession().then(({data})=>{
        if(data.session){
          loginBtn.style.display='none';
          registerBtn.style.display='none';
          logoutBtn.style.display='inline-block';
        }
      });

      document.getElementById('discoverBtn')
        .addEventListener('click',()=>document.getElementById('catalogue').scrollIntoView({behavior:'smooth'}));

      // Proposer un outil
      const proposerModal=document.getElementById('proposerModal'),
            closeProposerModal=document.getElementById('closeProposerModal'),
            proposerForm=document.getElementById('proposerForm');
      document.getElementById('proposeBtn').onclick=
      document.getElementById('menuProposerBtn').onclick=
      document.getElementById('footerProposerBtn').onclick=
        ()=>proposerModal.style.display='flex';
      closeProposerModal.onclick=()=>proposerModal.style.display='none';
      window.addEventListener('click',e=>{ if(e.target===proposerModal)proposerModal.style.display='none'; });

      proposerForm.onsubmit=async e=>{
        e.preventDefault();
        const nom=document.getElementById('outilNom').value,
              desc=document.getElementById('outilDesc').value,
              loc=document.getElementById('outilLocalisation').value,
              prop=document.getElementById('outilProprietaire').value;
        const { error }=await supabase.from('outils').insert([{ nom,description:desc,localisation:loc,proprietaire:prop,disponible:true }]);
        if(error) showNotification('Proposition : '+error.message,'error');
        else {
          showNotification('Proposition reçue','success');
          proposerModal.style.display='none';
          proposerForm.reset();
          chargerCatalogue();
        }
      };

      // Détails & Réservation
      const catalogueGrid=document.getElementById('catalogueGrid'),
            reservationModal=document.getElementById('reservationModal'),
            closeReservationModal=document.getElementById('closeReservationModal'),
            reservationForm=document.getElementById('reservationForm');

      catalogueGrid.addEventListener('click',e=>{
        const btn=e.target;
        if(btn.classList.contains('details-btn')){
          afficherDetails(btn.dataset.id);
        }
        if(btn.classList.contains('reserve-btn')){
          document.getElementById('resOutilId').value=btn.dataset.id;
          reservationModal.style.display='flex';
        }
      });

      closeReservationModal.onclick=()=>reservationModal.style.display='none';
      window.addEventListener('click',e=>{ if(e.target===reservationModal)reservationModal.style.display='none'; });

      reservationForm.onsubmit=async e=>{
        e.preventDefault();
        const id=document.getElementById('resOutilId').value;
        await supabase.from('reservations').insert([{
          outil_id:id,
          utilisateur_email:document.getElementById('resName').value,
          date_debut:document.getElementById('resDateDebut').value,
          date_fin:document.getElementById('resDateFin').value,
          statut:'en_attente'
        }]);
        showNotification('Réservation envoyée','success');
        reservationModal.style.display='none';
      };

      // Détails modal close
      document.getElementById('closeDetailsModal').onclick=
        ()=>document.getElementById('detailsModal').style.display='none';
      window.addEventListener('click',e=>{ if(e.target===document.getElementById('detailsModal'))
        document.getElementById('detailsModal').style.display='none'; });

      // Achats collectifs & contact
      document.getElementById('purchaseBtn')
        .onclick=()=>showNotification('Bientôt disponible','success');
      document.getElementById('contactForm')
        .addEventListener('submit',e=>{
          e.preventDefault();
          showNotification('Merci pour votre message !','success');
          e.target.reset();
        });
    });
  </script>
</body>
</html>
